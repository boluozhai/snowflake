<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<!--
/***********************************************************************
 * 
 * Login.html
 * 
 * @Copyright (c) 2016 boluozhai.com
 * @License MIT License
 * @Author xukun<xukun17@sina.com>
 * 
 */
-->

<head>

<meta charset='utf-8' />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>登录</title>

<link href="./lib/bootstrap/css/bootstrap.min.css" rel="stylesheet"
	type="text/css" />

<link href="./css/signin.css" rel="stylesheet" type="text/css" />


<style type="text/css">
.to-reg {
	margin-top: 100px;
	text-align: center;
}

.working {
	text-align: center;
}
</style>

</head>
<body>



	<div class="container">

		<form class="form-signin" role="form">
			<div>
				<h2 class="form-signin-heading">请登录</h2>
			</div>
			<div class='--no-work'>
				<input id='edit-email' type="email" class="form-control"
					placeholder="邮箱地址" required autofocus />
			</div>
			<div class='--no-work'>
				<input id='edit-passwd' type="password" class="form-control"
					placeholder="密码" required />
			</div>
			<div class="checkbox">
				<label> <input id='check-remember-me' type="checkbox"
					value="remember-me"> 记住登录状态
				</label>
			</div>
			<div class='working'>
				<div>正在登录...</div>
				<div class='progress'>
					<div class="progress-bar progress-bar-striped active"
						role="progressbar" aria-valuenow="100" aria-valuemin="0"
						aria-valuemax="100" style="width: 100%">
						<span class="sr-only">45% Complete</span>
					</div>
				</div>
			</div>
			<div class='no-work'>
				<button id='btn-ok' class="btn btn-lg btn-primary btn-block"
					type="button">登录</button>
			</div>
		</form>


		<div class='to-reg'>
			<span>还没有帐号?</span> <a href='Register.html'>注个册先！</a>
		</div>

	</div>


	<script src="./lib/jquery/jquery.min.js"></script>
	<script src="./lib/bootstrap/js/bootstrap.min.js"></script>

	<script src="./lib/snowflake/core.js"></script>
	<script src="./lib/snowflake/context.js"></script>
	<script src="./lib/snowflake/event.js"></script>
	<script src="./lib/snowflake/rest.js"></script>
	<script src="./lib/snowflake/listview.js"></script>
	<script src="./lib/snowflake/sha1.js"></script>

	<script src="./export/h2o/js/widget.js"></script>
	<script src="./export/h2o/js/folder.js"></script>
	<script src="./export/h2o/js/console.js"></script>

	<script src="./js/config.js"></script>
	<script src="./js/Auth.js"></script>
	<script src="./this.js"></script>

	<script type="text/javascript">
		var AuthCtrl = com.boluozhai.h2o.webui.auth.AuthCtrl;

		$(document).ready(function() {

			var context = Snowflake.getContext();
			var ctrl = new AuthCtrl(context);

			$('#btn-ok').click(function() {
				onClickOK(ctrl);
			});

			set_ui_mode(false);
			init_4_debug();

		});

		function init_4_debug() {

			$('#edit-email').val('test@blz');
			$('#edit-passwd').val('1234');

		}

		function set_ui_mode(in_working) {

			var w = $('.working');
			var nw = $('.no-work');

			if (in_working) {
				w.show();
				nw.hide();
			} else {
				nw.show();
				w.hide();
			}

		}

		function onClickOK(ctrl) {

			var email = $('#edit-email').val();
			var passwd = $('#edit-passwd').val();
			set_ui_mode(true);

			var task = ctrl.login();
			task.email(email);
			task.password(passwd);

			task.execute(function() {

				if (task.success()) {
					onLoginOK(task);
				} else {
					onLoginError(task);
				}

				set_ui_mode(false);

			});

		}

		function onLoginOK(task) {
			window.location = 'Working.html';
		}

		function onLoginError(task) {
			var msg = task.message();
			alert("登录失败！" + msg);
		}
	</script>

</body>
</html>